package org.engcia;

import org.engcia.model.drools.Evidence;
import org.engcia.model.drools.Hypothesis;
import org.engcia.model.drools.Conclusion;
import org.engcia.model.drools.Fact;

import function org.engcia.view.UI.answer;

query "Conclusions"
	$conclusion : Conclusion()
end

rule "r1: IF R > 1 THEN h(Sufficiently Charged Battery) - Atual - Limite Suficiente"
    when
        Evidence(description == "R", value == "greater")
    then
        //sufficiently charged battery?
        Hypothesis h = new Hypothesis("sufficiently charged battery", "true");
        insert(h);
end

rule "r2: IF R <= 1 THEN h(Participants With Surplus) - Margem entre consumo e produção"
    when
        Evidence(description == "R", value == "equal or less")
    then
        //participants with surplus?
        Hypothesis h = new Hypothesis("participants with surplus", "true");
        insert(h)
end

rule "r3: IF R > 1 AND Sufficiently Charged Battery THEN h(Community Demand) -"
    when
        Hypothesis(description == "R")
        Hypothesis(description == "sufficiently charged battery", value == "true")
    then
        //sufficiently charged battery?
        Hypothesis h = new Hypothesis("community demand", "true");
        insert(h)
end

rule "r4: IF R > 1 AND ~Sufficiently Charged Battery THEN h(Predicted Energy Scarcity)"
    when
        Hypothesis(description == "R")
        Evidence(description == "Sufficiently Charged Battery", value == "False")
    then
        //participants with surplus?
        Hypothesis h = new Hypothesis("participants with surplus", "true");
        insert(h)
end

rule "r5: IF R > 1 AND Predicted Energy Scarcity THEN CHARGE BATTERY"
    when
        Hypothesis(description == "R")
        Evidence(description == "Predicted Energy Scarcity", value == "True")
    then
        Conclusion c = new Conclusion(Conclusion.CHARGE_BATTERY);
        insert(c);
end

rule "r6: IF R > 1 AND ~Predicted Energy Scarcity THEN h(Expensive Hour)"
    when
        Hypothesis(description == "R")
        Evidence(description == "Predicted Energy Scarcity", value == "False")
    then
        //expensive hour?
        Hypothesis h = new Hypothesis("expensive hour", "true");
        insert(h)
end

rule "r7: IF R > 1 AND Expensive Hour THEN Community Demand"
    when
        Hypothesis(description == "R")
        Evidence(description == "Expensive Hour", value == "True")
    then
        //community demand?
        Hypothesis h = new Hypothesis("community demand", "true");
        insert(h)
end

rule "r8: IF R > 1 AND ~Expensive Hour THEN Charge Battery"
    when
        Hypothesis(description == "R")
        Evidence(description == "Expensive Hour", value == "False")
    then
        Conclusion c = new Conclusion(Conclusion.CHARGE_BATTERY);
        insert(c);
end

rule "r9: IF Community Demand THEN Sell to the local community market"
    when
        Hypothesis(description == "R")
        Evidence(description == "Predicted Energy Scarcity", value == "True")
    then
        Conclusion c = new Conclusion(Conclusion.SELL_TO_COMMUNITY);
        insert(c);
end


rule "r10: IF External market demand THEN Sell to the external market"
    when
        Evidence(description == "External market demand", value == "True")
    then
        Conclusion c = new Conclusion(Conclusion.SELL_EXTERNAL);
        insert(c);
end

rule "r11: IF ~External market demand THEN Send to the grid"
    when
        Evidence(description == "External market demand", value == "False")
    then
        Conclusion c = new Conclusion(Conclusion.SEND_GRID);
        insert(c);
end

rule "r12: IF Participants with surplus THEN Balance R using community market"
    when
        Evidence(description == "Participants with surplus", value == "True")
    then
        Conclusion c = new Conclusion(Conclusion.BALANCE_R);
        insert(c);
end

rule "r13: IF ~Participant with surplus THEN Predicted Energy Scarcity"
    when
        Evidence(description == "Participants with surplus", value == "False")
    then
        //participants with surplus?
        Hypothesis h = new Hypothesis("participants with surplus", "true");
        insert(h)
end

rule "r14: IF ~Participant with surplus AND Predicted Energy Scarcity THEN BUY"
    when
        Hypothesis(description == "Participants with surplus")
        Evidence(description == "Predicted Energy Scarcity", value == "True")
    then
        Conclusion c = new Conclusion(Conclusion.BUY_EXTERNAL);
        insert(c);
end

rule "r15: IF ~Participant with surplus AND ~Expensive Hour THEN Buy"
    when
        Hypothesis(description == "Participants with surplus")
        Evidence(description == "Expensive Hour", value == "False")
    then
        Conclusion c = new Conclusion(Conclusion.BUY_EXTERNAL);
        insert(c);
end

rule "r16: IF ~Participant with surplus AND ~Sufficiently Charged Battery THEN Buy"
    when
        Hypothesis(description == "Participants with surplus")
        Evidence(description == "Sufficiently Charged Battery", value == "False")
    then
        Conclusion c = new Conclusion(Conclusion.BUY_EXTERNAL);
        insert(c);
end

rule "r17: IF Participants with surplus AND Sufficient THEN Use Battery's Energy"
    when
        Hypothesis(description == "Participants with surplus")
        Evidence(description == "Sufficiently Charged Battery", value == "True")
    then
        Conclusion c = new Conclusion(Conclusion.USE_BATTERY);
        insert(c);
end
