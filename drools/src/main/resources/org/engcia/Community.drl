package org.engcia;

import org.engcia.model.drools.Evidence;
import org.engcia.model.drools.Hypothesis;
import org.engcia.model.drools.Conclusion;
import org.engcia.model.drools.Fact;

import function org.engcia.view.UI.answer;

query "Conclusions"
	$conclusion : Conclusion()
end

rule "R1: Ratio greather than 1"
    when
        Evidence(evidence == "R", value == "greater")
    then
        //sufficiently charged battery?
        Hypothesis h = new Hypothesis("sufficiently charged battery", "true");
        insert(h);
end

rule "R2: Ratio equal or less than 1"
    when
        Evidence(evidence == "R", value == "equal or less")
    then
        //participants with surplus?
        Hypothesis h = new Hypothesis("participants with surplus", "true");
        insert(h);
end

rule "R3: Ratio greater than 1 and Sufficiently Charged Batteries"
    when
        Hypothesis(description == "R")
        Hypothesis(description == "sufficiently charged battery", value == "true")
    then
        //sufficiently charged battery?
        Hypothesis h = new Hypothesis("community demand", "true");
        insert(h);
end

rule "R4: Ratio greater than 1 and Not Sufficiently Charged Batteries"
    when
        Hypothesis(description == "R")
        Evidence(evidence == "Sufficiently Charged Battery", value == "False")
    then
        //participants with surplus?
        Hypothesis h = new Hypothesis("participants with surplus", "true");
        insert(h);
end

rule "R5: Ratio greater than 1 and Predicted Energy Scarcity"
    when
        Hypothesis(description == "R")
        Evidence(evidence == "Predicted Energy Scarcity", value == "True")
    then
        Conclusion c = new Conclusion(Conclusion.CHARGE_BATTERY);
        insert(c);
end

rule "R6: Ratio greater than 1 and not Predicted Energy Scarcity"
    when
        Hypothesis(description == "R")
        Evidence(evidence == "Predicted Energy Scarcity", value == "False")
    then
        //expensive hour?
        Hypothesis h = new Hypothesis("expensive hour", "true");
        insert(h);
end

rule "R7: Ratio greater than 1 and Expensive Hour"
    when
        Hypothesis(description == "R")
        Evidence(evidence == "expensive hour", value == "True")
    then
        //community demand?
        Hypothesis h = new Hypothesis("community demand", "true");
        insert(h);
end

rule "R8: Ratio greater than 1 and not Expensive Hour"
    when
        Hypothesis(description == "R")
        Evidence(evidence == "Expensive Hour", value == "False")
    then
        Conclusion c = new Conclusion(Conclusion.CHARGE_BATTERY);
        insert(c);
end

rule "R9: Ratio greater than 1 and Community Demand"
    when
        Hypothesis(description == "R")
        Evidence(evidence == "Predicted Energy Scarcity", value == "True")
    then
        Conclusion c = new Conclusion(Conclusion.SELL_TO_COMMUNITY);
        insert(c);
end


rule "R10: External market demand"
    when
        Evidence(evidence == "External market demand", value == "True")
    then
        Conclusion c = new Conclusion(Conclusion.SELL_EXTERNAL);
        insert(c);
end

rule "R11: Not External market"
    when
        Evidence(evidence == "External market demand", value == "False")
    then
        Conclusion c = new Conclusion(Conclusion.SEND_GRID);
        insert(c);
end

rule "R12: Participants with surplus"
    when
        Evidence(evidence == "Participants with surplus", value == "True")
    then
        Conclusion c = new Conclusion(Conclusion.BALANCE_R);
        insert(c);
end

rule "R13: Not Participant with surplus"
    when
        Evidence(evidence == "Participants with surplus", value == "False")
    then
        //participants with surplus?
        Hypothesis h = new Hypothesis("participants with surplus", "true");
        insert(h);
end

rule "R14: Not Participant with surplus AND Predicted Energy Scarcity"
    when
        Hypothesis(description == "Participants with surplus")
        Evidence(evidence == "Predicted Energy Scarcity", value == "True")
    then
        Conclusion c = new Conclusion(Conclusion.BUY_EXTERNAL);
        insert(c);
end

rule "R15: Not Participant with surplus AND not Expensive Hour"
    when
        Hypothesis(description == "Participants with surplus")
        Evidence(evidence == "Expensive Hour", value == "False")
    then
        Conclusion c = new Conclusion(Conclusion.BUY_EXTERNAL);
        insert(c);
end

rule "R16: Not Participant with surplus AND not Sufficiently Charged Battery"
    when
        Hypothesis(description == "Participants with surplus")
        Evidence(evidence == "Sufficiently Charged Battery", value == "False")
    then
        Conclusion c = new Conclusion(Conclusion.BUY_EXTERNAL);
        insert(c);
end

rule "R17: Participants with surplus AND Sufficient Charged Battery"
    when
        Hypothesis(description == "Participants with surplus")
        Evidence(evidence == "Sufficiently Charged Battery", value == "True")
    then
        Conclusion c = new Conclusion(Conclusion.USE_BATTERY);
        insert(c);
end
